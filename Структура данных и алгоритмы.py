import math
import random

def energy_function(x, y):
    """
    Функция энергии (целевая функция) - сумма квадратов невязок уравнений
    Чем меньше значение, тем лучше решение
    """
    eq1 = x**2 + y**2 - 25  # x² + y² = 25
    eq2 = x + y - 7         # x + y = 7
    return eq1**2 + eq2**2  # Сумма квадратов невязок

def simulated_annealing(initial_temp=1000, cooling_rate=0.95, 
                       min_temp=1e-6, max_iter=10000):
    """
    Реализация алгоритма имитации отжига
    
    Параметры:
    initial_temp - начальная температура
    cooling_rate - скорость охлаждения (0.9-0.99)
    min_temp - минимальная температура (критерий остановки)
    max_iter - максимальное количество итераций
    """
    
    # Начальное случайное решение в диапазоне [-10, 10]
    current_x = random.uniform(-10, 10)
    current_y = random.uniform(-10, 10)
    current_energy = energy_function(current_x, current_y)
    
    # Лучшее найденное решение
    best_x, best_y = current_x, current_y
    best_energy = current_energy
    
    temperature = initial_temp
    iteration = 0
    
    print("Начальные параметры:")
    print(f"Температура: {temperature}")
    print(f"Начальная точка: ({current_x:.4f}, {current_y:.4f})")
    print(f"Начальная энергия: {current_energy:.6f}")
    print("-" * 50)
    
    while temperature > min_temp and iteration < max_iter:
        # Генерация нового кандидата
        new_x = current_x + random.uniform(-1, 1) * temperature
        new_y = current_y + random.uniform(-1, 1) * temperature
        new_energy = energy_function(new_x, new_y)
        
        # Разница энергий (чем меньше new_energy, тем лучше)
        delta_energy = new_energy - current_energy
        
        # Критерий принятия решения
        if delta_energy < 0:
            # Новое решение лучше - принимаем всегда
            current_x, current_y = new_x, new_y
            current_energy = new_energy
            
            # Обновляем лучшее решение
            if new_energy < best_energy:
                best_x, best_y = new_x, new_y
                best_energy = new_energy
        else:
            # Новое решение хуже - принимаем с вероятностью
            probability = math.exp(-delta_energy / temperature)
            if random.random() < probability:
                current_x, current_y = new_x, new_y
                current_energy = new_energy
        
        # Охлаждение
        temperature *= cooling_rate
        iteration += 1
        
        # Вывод прогресса каждые 1000 итераций
        if iteration % 1000 == 0:
            print(f"Итерация {iteration}: энергия = {current_energy:.8f}, "
                  f"температура = {temperature:.6f}")
    
    return best_x, best_y, best_energy, iteration

def exact_solution():
    """
    Точное аналитическое решение для проверки
    """
    # Из второго уравнения: y = 7 - x
    # Подставляем в первое: x² + (7-x)² = 25
    # x² + 49 - 14x + x² = 25
    # 2x² - 14x + 24 = 0
    # x² - 7x + 12 = 0
    # x = 3, x = 4
    
    solutions = []
    for x in [3, 4]:
        y = 7 - x
        solutions.append((x, y))
    return solutions

# Запуск алгоритма
print("=" * 60)
print("РЕШЕНИЕ СИСТЕМЫ УРАВНЕНИЙ МЕТОДОМ ИМИТАЦИИ ОТЖИГА")
print("=" * 60)
print("Система уравнений:")
print("x² + y² = 25")
print("x + y = 7")
print()

# Запускаем алгоритм несколько раз для надежности
best_overall = None
best_energy_overall = float('inf')

for run in range(5):
    print(f"\n--- Запуск {run + 1} ---")
    x, y, energy, iterations = simulated_annealing(
        initial_temp=1000, 
        cooling_rate=0.93,
        min_temp=1e-8,
        max_iter=5000
    )
    
    print(f"Найдено решение: x = {x:.6f}, y = {y:.6f}")
    print(f"Энергия (сумма квадратов невязок): {energy:.10f}")
    print(f"Проверка:")
    print(f"  x² + y² = {x**2 + y**2:.6f} (должно быть 25)")
    print(f"  x + y = {x + y:.6f} (должно быть 7)")
    
    if energy < best_energy_overall:
        best_energy_overall = energy
        best_overall = (x, y, energy)

# Вывод лучшего результата
print("\n" + "=" * 60)
print("ЛУЧШЕЕ НАЙДЕННОЕ РЕШЕНИЕ:")
print("=" * 60)
if best_overall:
    x, y, energy = best_overall
    print(f"x = {x:.8f}")
    print(f"y = {y:.8f}")
    print(f"Точность: {energy:.12f}")
    print()
    print("Проверка:")
    print(f"x² + y² = {x**2 + y**2:.10f} (ошибка: {abs(x**2 + y**2 - 25):.2e})")
    print(f"x + y = {x + y:.10f} (ошибка: {abs(x + y - 7):.2e})")

# Точные решения для сравнения
print("\n" + "=" * 60)
print("ТОЧНЫЕ АНАЛИТИЧЕСКИЕ РЕШЕНИЯ:")
print("=" * 60)
exact_solutions = exact_solution()
for i, (x_exact, y_exact) in enumerate(exact_solutions, 1):
    print(f"Решение {i}: x = {x_exact}, y = {y_exact}")
    print(f"Проверка: x² + y² = {x_exact**2 + y_exact**2}, x + y = {x_exact + y_exact}")
    print()

"""
   РЕШЕНИЕ СИСТЕМЫ УРАВНЕНИЙ МЕТОДОМ ИМИТАЦИИ ОТЖИГА
============================================================
Система уравнений:
x² + y² = 25
x + y = 7


--- Запуск 1 ---
Начальные параметры:
Температура: 1000
Начальная точка: (-8.4867, -9.5730)
Начальная энергия: 19856.199886
--------------------------------------------------
Найдено решение: x = 5.011910, y = -0.377245
Энергия (сумма квадратов невязок): 5.6632228014
Проверка:
  x² + y² = 25.261553 (должно быть 25)
  x + y = 4.634664 (должно быть 7)

--- Запуск 2 ---
Начальные параметры:
Температура: 1000
Начальная точка: (-5.8944, -8.0813)
Начальная энергия: 6072.833180
--------------------------------------------------
Найдено решение: x = -0.510473, y = 4.998277
Энергия (сумма квадратов невязок): 6.3703515002
Проверка:
  x² + y² = 25.243360 (должно быть 25)
  x + y = 4.487804 (должно быть 7)

--- Запуск 3 ---
Начальные параметры:
Температура: 1000
Начальная точка: (-0.1245, 1.3329)
Начальная энергия: 572.151371
--------------------------------------------------
Найдено решение: x = 5.028839, y = -0.121359
Энергия (сумма квадратов невязок): 4.4710243373
Проверка:
  x² + y² = 25.303948 (должно быть 25)
  x + y = 4.907480 (должно быть 7)

--- Запуск 4 ---
Начальные параметры:
Температура: 1000
Начальная точка: (-8.0104, 5.3867)
Начальная энергия: 4741.593709
--------------------------------------------------
Найдено решение: x = -3.128335, y = 3.916875
Энергия (сумма квадратов невязок): 38.5987129219
Проверка:
  x² + y² = 25.128387 (должно быть 25)
  x + y = 0.788540 (должно быть 7)

--- Запуск 5 ---
Начальные параметры:
Температура: 1000
Начальная точка: (5.8901, -2.9524)
Начальная энергия: 355.428594
--------------------------------------------------
Найдено решение: x = 5.035917, y = -0.125139
Энергия (сумма квадратов невязок): 4.5063127517
Проверка:
  x² + y² = 25.376119 (должно быть 25)
  x + y = 4.910778 (должно быть 7)

============================================================
ЛУЧШЕЕ НАЙДЕННОЕ РЕШЕНИЕ:
============================================================
x = 5.02883887
y = -0.12135882
Точность: 4.471024337282

Проверка:
x² + y² = 25.3039483714 (ошибка: 3.04e-01)
x + y = 4.9074800539 (ошибка: 2.09e+00)

============================================================
ТОЧНЫЕ АНАЛИТИЧЕСКИЕ РЕШЕНИЯ:
============================================================
Решение 1: x = 3, y = 4
Проверка: x² + y² = 25, x + y = 7

Решение 2: x = 4, y = 3
Проверка: x² + y² = 25, x + y = 7
    """
